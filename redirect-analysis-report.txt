üîç –ü–û–ò–°–ö –í–°–ï–• –†–ï–î–ò–†–ï–ö–¢–û–í –í –ü–†–û–ï–ö–¢–ï
===================================

1. –ü–†–û–í–ï–†–ö–ê page.tsx (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞):
-----------------------------------------
–§–∞–π–ª: apps/web/app/page.tsx
–ò—â–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã...
–ù–∞–π–¥–µ–Ω–æ:
- –°—Ç—Ä–æ–∫–∞ 5: import { redirect } from "next/navigation";
- –°—Ç—Ä–æ–∫–∞ 20: //   redirect("/auth/signin"); (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ)

2. –ü–†–û–í–ï–†–ö–ê layout.tsx:
-----------------------
–§–∞–π–ª: apps/web/app/layout.tsx
–†–µ–∑—É–ª—å—Ç–∞—Ç: –ù–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤

3. –ü–†–û–í–ï–†–ö–ê providers.tsx:
--------------------------
–§–∞–π–ª: apps/web/app/providers.tsx
–†–µ–∑—É–ª—å—Ç–∞—Ç: –ù–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤

4. –ü–†–û–í–ï–†–ö–ê auth/signin/page.tsx:
----------------------------------
–§–∞–π–ª: apps/web/app/auth/signin/page.tsx
–†–µ–∑—É–ª—å—Ç–∞—Ç: –ù–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤

5. –ü–†–û–í–ï–†–ö–ê auth-options.ts redirect callback:
-----------------------------------------------
–§–∞–π–ª: apps/web/lib/auth-options.ts
Callback —Ñ—É–Ω–∫—Ü–∏—è redirect (—Å—Ç—Ä–æ–∫–∏ 81-87):
async redirect({ url, baseUrl }) {
  // Allows relative callback URLs
  if (url.startsWith("/")) return `${baseUrl}${url}`;
  // Allows callback URLs on the same origin
  else if (new URL(url).origin === baseUrl) return url;
  return baseUrl;
},

6. –ü–†–û–í–ï–†–ö–ê [...nextauth]/route.ts:
------------------------------------
–§–∞–π–ª: apps/web/app/api/auth/[...nextauth]/route.ts
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
export const dynamic = 'force-dynamic';
export const revalidate = 0;

export const runtime = 'nodejs';

import NextAuth from 'next-auth';
import { authOptions } from '@/lib/auth-options';
const handler = NextAuth(authOptions);
export { handler as GET, handler as POST };

7. –í–°–ï –§–ê–ô–õ–´ –° redirect() –∏–∑ 'next/navigation':
------------------------------------------------
–ù–∞–π–¥–µ–Ω–æ 3 —Ñ–∞–π–ª–∞:
- apps/web/app/party/[id]/page.tsx - –∏–º–ø–æ—Ä—Ç notFound
- apps/web/app/auth/signin/page.tsx - –∏–º–ø–æ—Ä—Ç useSearchParams
- apps/web/app/auth/error/page.tsx - –∏–º–ø–æ—Ä—Ç useSearchParams

8. –ü–†–û–í–ï–†–ö–ê –°–ï–†–í–ï–†–ù–´–• –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –° getServerSession:
------------------------------------------------------
–ù–∞–π–¥–µ–Ω–æ 45 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π –≤ 18 —Ñ–∞–π–ª–∞—Ö:
- apps/web/app/page.tsx - 2 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- apps/web/app/party/[id]/page.tsx - 1 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- apps/web/app/api/auth/spotify/status/route.ts - 1 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- apps/web/app/api/music/portrait/route.ts - 1 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- apps/web/app/api/auth/spotify/disconnect/route.ts - 2 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- apps/web/app/api/parties/[id]/route.ts - 3 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- apps/web/app/api/parties/[id]/tracks/route.ts - 2 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- apps/web/app/api/parties/[id]/tracks/[trackId]/vote/route.ts - 1 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- apps/web/app/api/parties/route.ts - 2 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- apps/web/app/api/parties/join/route.ts - 1 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- apps/web/app/api/spotify/player/route.ts - 3 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- apps/web/app/api/auth/spotify/login/route.ts - 1 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- apps/web/app/api/auth/spotify/connect/route.ts - 1 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- apps/web/app/api/auth/spotify/callback/route.ts - 1 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- apps/web/app/api/auth/spotify/refresh/route.ts - 1 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- apps/web/app/api/auth/apple-music/callback/route.ts - 3 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- apps/web/app/api/music/search/route.ts - 1 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- apps/web/app/party/[id]/tracks/[trackId]/vote/route.ts - 1 –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

9. –ü–†–û–í–ï–†–ö–ê –ù–ê –¶–ò–ö–õ–ò–ß–ï–°–ö–ò–ï –†–ï–î–ò–†–ï–ö–¢–´:
--------------------------------------
–ò—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Ç–∏–ø–∞:
- redirect('/') –≤ signin
- redirect('/auth/signin') –≤ –≥–ª–∞–≤–Ω–æ–π
–†–µ–∑—É–ª—å—Ç–∞—Ç: –¶–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

10. –ü–†–û–í–ï–†–ö–ê storage-factory.ts:
---------------------------------
–ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π storage –¥–ª—è Vercel:
–§–∞–π–ª: apps/web/lib/storage-factory.ts
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ storage:
// Use file storage for both development and production
// Memory storage causes data loss in production
export const storage = fileStorage;

üìä –ò–¢–û–ì–û–í–´–ô –ê–ù–ê–õ–ò–ó:

‚úÖ –•–û–†–û–®–ò–ï –ù–û–í–û–°–¢–ò:
- –¶–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ
- –í page.tsx —Ä–µ–¥–∏—Ä–µ–∫—Ç –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω (—Å—Ç—Ä–æ–∫–∞ 20)
- auth-options.ts –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É redirect callback
- Storage –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è production
- Middleware –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

‚ö†Ô∏è –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–´–ï –ü–†–û–ë–õ–ï–ú–´:
- –í page.tsx –µ—Å—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
- –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç getServerSession, —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å middleware
- –í auth-options.ts –µ—Å—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ pages (—Å—Ç—Ä–æ–∫–∏ 59-62 –∏ 166-169)

üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:
1. –£–¥–∞–ª–∏—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –∏–∑ page.tsx
2. –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ pages –≤ auth-options.ts
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É middleware - –≤–æ–∑–º–æ–∂–Ω–æ, –µ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É middleware –∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ API routes –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
5. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤–º–µ—Å—Ç–æ getServerSession –≤ –∫–∞–∂–¥–æ–º API route

üìù –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø:
- Middleware –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ –Ω–µ –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤
- –í—Å–µ –ø—É—Ç–∏ /party –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—É–±–ª–∏—á–Ω—ã–µ –≤ middleware, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- API routes (–∫—Ä–æ–º–µ auth) –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è middleware –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
