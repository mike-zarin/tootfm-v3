# tootFM Critical Fixes Report

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚úÖ 1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ Spotify
**–ü—Ä–æ–±–ª–µ–º–∞:** –í–≤–µ—Ä—Ö—É –ø–æ–∫–∞–∑—ã–≤–∞–ª–æ—Å—å "Your Spotify is connected", –∞ –≤–Ω–∏–∑—É "Not connected"
**–†–µ—à–µ–Ω–∏–µ:** 
- –£–±—Ä–∞–ª–∏ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –º—É–∑—ã–∫–∞–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –û—Å—Ç–∞–≤–∏–ª–∏ —Ç–æ–ª—å–∫–æ –µ–¥–∏–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `MusicProfileManager`
- –ü–µ—Ä–µ–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∏–∑ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

### ‚úÖ 2. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Apple Music
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–≤–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ "Connect Apple Music"
**–†–µ—à–µ–Ω–∏–µ:**
- –£–±—Ä–∞–ª–∏ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
- –û—Å—Ç–∞–≤–∏–ª–∏ –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ `MusicProfileManager`

### ‚úÖ 3. –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç—É—Å–æ–≤
**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö (SSR vs CSR)
**–†–µ—à–µ–Ω–∏–µ:**
- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç –Ω–∞—á–∞–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –≤ `MusicProfileManager`
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ baseline
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ API calls

### ‚úÖ 4. –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–ø—É—Ç–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º
**–†–µ—à–µ–Ω–∏–µ:**
- –£–ø—Ä–æ—Å—Ç–∏–ª–∏ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –°–¥–µ–ª–∞–ª–∏ `MusicProfileManager` –æ—Å–Ω–æ–≤–Ω—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞–º–∏
- –î–æ–±–∞–≤–∏–ª–∏ —Å–µ–∫—Ü–∏—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ Music Portrait
- –£–ª—É—á—à–∏–ª–∏ –≤–∏–∑—É–∞–ª—å–Ω—É—é –∏–µ—Ä–∞—Ä—Ö–∏—é

### ‚úÖ 5. Apple Music –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∞ 400 "Failed to save connection"
**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø—Ä–∞–≤–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `session.user.id` vs `user.id` –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –û–±–Ω–æ–≤–∏–ª–∏ —Ç–∏–ø `AppleMusicProfile` —Å –ø–æ–ª—è–º–∏ `userId`, `storefront`, `expiresAt`
- –ò—Å–ø—Ä–∞–≤–∏–ª–∏ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏ –º–µ—Ç–æ–¥—ã –≤ callback endpoint
- –î–æ–±–∞–≤–∏–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

## –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ `/apps/web/app/page.tsx` - —É–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–ø—Ä–æ—â–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ `/apps/web/components/music/MusicProfileManager.tsx` - —É–ª—É—á—à–µ–Ω UI, –¥–æ–±–∞–≤–ª–µ–Ω—ã props

### API Endpoints
- ‚úÖ `/apps/web/app/api/auth/apple-music/callback/route.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –º–µ—Ç–æ–¥—ã
- ‚úÖ `/apps/web/app/api/auth/spotify/disconnect/route.ts` - –¥–æ–±–∞–≤–ª–µ–Ω GET endpoint

### –¢–∏–ø—ã
- ‚úÖ `/apps/web/types/index.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω `AppleMusicProfile`

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ Spotify/Apple Music
- ‚ùå –ü—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚ùå Apple Music –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è (–æ—à–∏–±–∫–∞ 400)
- ‚ùå –ó–∞–ø—É—Ç–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º—É–∑—ã–∫–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ Apple Music –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ß–µ—Ç–∫–∞—è –≤–∏–∑—É–∞–ª—å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Music Portrait

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **Spotify:** –°—Ç–∞—Ç—É—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, disconnect —Ä–∞–±–æ—Ç–∞–µ—Ç
2. **Apple Music:** –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Å—Ç–∞—Ç—É—Å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
3. **UI:** –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, —á–µ—Ç–∫–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è
4. **Music Portrait:** –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–≥–¥–∞ –µ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã! üéâ
