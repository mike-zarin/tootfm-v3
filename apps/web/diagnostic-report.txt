═══════════════════════════════════════════════════════════════
         tootFM ULTIMATE DIAGNOSTIC & FIX v3.0                  
═══════════════════════════════════════════════════════════════
Time: Fri Aug 29 23:39:12 EEST 2025
Dir: /Users/mz/tootfm-v3/apps/web

═══════════════════════════════════════════════════════════════
SECTION 1: FILE STRUCTURE & DEPENDENCIES
═══════════════════════════════════════════════════════════════

[0;34m1.1 Core Files Check[0m
─────────────────────
  [0;32m✓[0m package.json (    1690 bytes)
  [0;32m✓[0m next.config.js (     489 bytes)
  [0;32m✓[0m tsconfig.json (     703 bytes)
  [0;32m✓[0m tailwind.config.ts (    2198 bytes)
  [0;32m✓[0m .env.local (     850 bytes)
  [0;32m✓[0m data.json (   10483 bytes)
  [0;32m✓[0m lib/storage.ts (   11675 bytes)
  [0;32m✓[0m lib/utils.ts (     190 bytes)
  [0;32m✓[0m types/index.ts (    2820 bytes)

[0;34m1.2 Node Modules & Build[0m
─────────────────────
  [0;31m✗[0m node_modules missing
  [0;32m✓[0m .next build cache exists
═══════════════════════════════════════════════════════════════
SECTION 2: CLIENT/SERVER ARCHITECTURE ANALYSIS
═══════════════════════════════════════════════════════════════

[0;34m2.1 Page Components Analysis[0m
─────────────────────

  [1;33mServer Components (using fs/storage):[0m
    [0;32m✓[0m app/page.tsx (uses storage: 5 times)
    [0;32m✓[0m app/party/[id]/page.tsx (uses storage: 4 times)

  [1;33mClient Components (using hooks):[0m
    [0;32m✓[0m app/party/create/page.tsx (hooks: 0)
    [0;32m✓[0m app/party/join/page.tsx (hooks: 0)
    [0;32m✓[0m app/auth/signin/page.tsx (hooks: 4)
    [0;32m✓[0m app/auth/error/page.tsx (hooks: 2)

[0;34m2.2 Component Props Analysis[0m
─────────────────────

  [1;33mChecking for invalid Server->Client props:[0m
    [0;32m✓[0m No function props found in Server Components
═══════════════════════════════════════════════════════════════
SECTION 3: USER ID & AUTHENTICATION CONSISTENCY
═══════════════════════════════════════════════════════════════

[0;34m3.1 User ID Analysis[0m
─────────────────────

  [1;33mData structure analysis:[0m
    Found 1 users:
      - user_1756401795176 (mihail.zarin@gmail.com)

    Found 2 unique host IDs:
      - user_1756401795176 (hosts 11 parties)
      - zarinmk (hosts 1 parties)

    $[31m✗$[0m ID MISMATCH DETECTED!
      Host IDs not in users table: {'zarinmk'}
    $[31m✗$[0m Membership IDs not in users: {'zarinmk'}
    [0;31m✗[0m User ID mismatch detected!
═══════════════════════════════════════════════════════════════
SECTION 4: API ROUTES & STORAGE FUNCTIONS
═══════════════════════════════════════════════════════════════

[0;34m4.1 API Routes Check[0m
─────────────────────
  [0;32m✓[0m route.ts
    [1;33m![0m Uses session.user.id as hostId (might be Google ID)
  [0;32m✓[0m route.ts
  [0;32m✓[0m route.ts
  [0;32m✓[0m route.ts
  [0;32m✓[0m route.ts

[0;34m4.2 Storage Functions Check[0m
─────────────────────
  [0;32m✓[0m getParty
  [0;32m✓[0m createParty
  [0;32m✓[0m getPartyMembers
  [0;32m✓[0m getUserByEmail
  [0;32m✓[0m createUser
  [0;32m✓[0m generateUniquePartyCode
═══════════════════════════════════════════════════════════════
SECTION 5: UI COMPONENTS & IMPORTS
═══════════════════════════════════════════════════════════════

[0;34m5.1 UI Components 'use client' Check[0m
─────────────────────
  [0;32m✓[0m All UI components have 'use client'

[0;34m5.2 Import Analysis[0m
─────────────────────
  [0;32m✓[0m No @tootfm/ui imports found
═══════════════════════════════════════════════════════════════
SECTION 6: TYPESCRIPT & COMPILATION
═══════════════════════════════════════════════════════════════

[0;34m6.1 TypeScript Compilation Check[0m
─────────────────────
  [1;33m![0m Cannot check TypeScript (npx not available or node_modules missing)
═══════════════════════════════════════════════════════════════
SECTION 7: RUNTIME ISSUES
═══════════════════════════════════════════════════════════════

[0;34m7.1 Known Runtime Issues[0m
─────────────────────
  [0;32m✓[0m CopyCodeButton is Client Component
  [0;32m✓[0m No onTrackAdded prop found
═══════════════════════════════════════════════════════════════
                          FINAL REPORT                          
═══════════════════════════════════════════════════════════════

[0;31mCRITICAL ERRORS (1):[0m
  ✗ User ID mismatch: hostId in parties doesn't match user IDs

[1;33mERRORS (1):[0m
  • node_modules missing - run npm install

[0;34mWARNINGS (1):[0m
  ⚠ parties/route.ts uses session.user.id which might be Google ID

[0;32mRECOMMENDED FIXES:[0m
─────────────────────
1. Fix User ID mismatch:
   - Update hostId in parties to use storage user IDs
   - Fix app/api/parties/route.ts to use correct user ID

2. Fix Server/Client architecture:
   - Remove 'use client' from pages using storage
   - Add 'use client' to pages using hooks
   - Remove onTrackAdded prop from TrackSearch

3. Fix imports:
   - Replace @tootfm/ui with @/components/ui/*

4. Install dependencies if missing:
   npm install

═══════════════════════════════════════════════════════════════
Status: NEEDS FIXES
Critical: 1, Errors: 1, Warnings: 1
═══════════════════════════════════════════════════════════════
